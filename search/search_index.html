<!doctype html>
<html lang = "zh">
    <head>
        <title>search test</title>
        <meta charset = "utf-8" />
        <meta name = "keywords" content = "search test" />
        <meta name = "description" content = "for test" />
        <meta name = "author" content = "hhh" />
        <meta name = "robots" content = "all" />
        <script type = "text/javascript" src = "../frame/react.js"></script>
        <script type = "text/javascript" src = "../frame/react-dom.js"></script>
        <script type = "text/javascript" src = "../frame/babel_browser.js"></script>
        <style type = "text/css">

        </style>
    </head>
    <body>
        <div id = "page"></div>
        <script type = "text/babel">
            var gods = [
                {'name' : 'apple' , 'value' : '$2' , 'category' : 'fruit' , 'stock' : false},
                {'name' : 'banana' , 'value' : '$3' , 'category' : 'fruit' , 'stock' : false},
                {'name' : 'pear' , 'value' : '$4' , 'category' : 'fruit' , 'stock' : true},
                {'name' : 'watermolen' , 'value' : '$2.5' , 'category' : 'fruit' , 'stock' : false},
                {'name' : 'orange' , 'value' : '$1' , 'category' : 'fruit' , 'stock' : false},
                {'name' : 'xiaomi' , 'value' : '$200' , 'category' : 'phone' , 'stock' : true},
                {'name' : 'huawei' , 'value' : '$300' , 'category' : 'phone' , 'stock' : false},
                {'name' : 'oneplus' , 'value' : '$400' , 'category' : 'phone' , 'stock' : false},
                {'name' : 'meizu' , 'value' : '$220' , 'category' : 'phone' , 'stock' : true}
            ];
            var FilterableProductTable = React.createClass({
                'result' : []
                ,getInitialState(){
                    return {'filterText' : '' , 'inStockOnly' : false};
                },
                searchFun(event){
                    var elements = document.getElementsByTagName('input');
                    var filterText = elements[0].value;
                    var inStockOnly = (elements[1].checked == true);
                    this.setState({'filterText' : filterText , 'inStockOnly' : inStockOnly});
                    console.log(`${filterText} ${inStockOnly}`);
                    this.result = [];
                    for(var i = 0 , len = gods.length ; i < len ; i++){
                        if(gods[i]['stock'] == this.state.inStockOnly){
                            if((gods[i]['category'].search(this.state.filterText)) != -1){
                                this.result.push(gods[i]);
                            }
                        }
                    }
                }
                ,render(){
                    return (
                        <div className = "filterableProductTable">
                            <SearchBar changeState = {this.searchFun} />
                            <ProductTable data = {this.result} />
                        </div>
                    );

                }
            });
            var SearchBar = React.createClass({
                render(){return (
                    <div className = "searchBar">
                        <input type = "text" ref = "userInput" onChange = {this.props.changeState} />
                        <input type = "checkbox" ref = "stock" onChange = {this.props.changeState} />
                    </div>
                    );
                }
            });
            var ProductTable = React.createClass({
                render(){
                    var productNode = this.props.data.map((product) => {
                        return (<ProductRow product = {product} />);
                    });
                    return (
                        <div className = "productRow">
                            {productNode}
                        </div>
                    );
                }
            });
            var ProductRow = React.createClass({
                render(){
                    return(
                            <ul>
                                <li>{this.props.product['name']}</li>
                            </ul>
                    );
                }
            });
            ReactDOM.render(<FilterableProductTable /> , document.getElementById('page'));
        </script>
    </body>
</html>